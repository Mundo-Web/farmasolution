import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BOnQTV8N.js";import{R as Te}from"./PolicyModal-CPFjYZfq.js";import{H as Ge}from"./HtmlContent-ghmllTyl.js";import{N as k}from"./Number2Currency-e57Tgsuk.js";import{D as ye,C as We,B as Fe,a as Ie,P as Ye,b as Je,A as Ke,O as Qe,c as Xe}from"./OptionCard-BlnblP-z.js";import{m as W}from"./main-DKOTUah5.js";import{t as le}from"./index-DRg3WPTA.js";import{I as G}from"./InputForm-Dmyom2PO.js";import{s as Ze}from"./server.browser-Bf4gQIc7.js";import{l as De}from"./ShippingStep-DrbxoqQN.js";import{S as es}from"./react-select.esm-CedBhnEL.js";import{G as re}from"./General-BmbBKdsB.js";import{G as ue}from"./Global-ErywZRdd.js";import{U as ss,a as ts}from"./ShippingStepSF-D8M_b1Cc.js";import{i as $e}from"./tippy-react.esm-Ce0cOK54.js";import{C as ce}from"./circle-x-5vreeYph.js";import"./ProductNavigation-Ch9gAwXA.js";import"./ProductCard-Lp5WfZrB.js";/* empty css              */import"./BlogCarousel-x7cPG0b1.js";/* empty css               */import"./BlogCarrusel-BEReD9tm.js";import{X as ns}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";import"./index-Chjiymov.js";import"./createLucideIcon-DfjclApS.js";import"./sparkles-DvmvZ6mJ.js";import"./CartItemRow-CiD11yvl.js";import"./proxy-yQpHkKD-.js";import"./trash-2-DU7LB6-f.js";import"./plus-CTIomuuF.js";import"./index-Dq7h7Pqt.js";import"./useStateManager-7e1e8489.esm-BASof734.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./index-C0Swrixi.js";import"./floating-ui.dom-BPWAutIm.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./VoucherUpload-D8VXjIYC.js";import"./filepond-plugin-image-preview-9tNWAy7Z.js";import"./SalesRest-CibXW26g.js";import"./BasicRest-BCYKfs4R.js";import"./chevron-up-Mt3xll-e.js";import"./chevron-down-uIVDLcM-.js";import"./ItemsRest-9bICvOQx.js";import"./HeaderSearch-BvA9RYGN.js";import"./index-BcIiOZSt.js";import"./eye-ScgfreHn.js";function rs({data:g,cart:y,setCart:P,onContinue:j,subTotal:a,envio:T,igv:q,totalFinal:c,openModal:E,automaticDiscounts:b,setAutomaticDiscounts:n,automaticDiscountTotal:F,setAutomaticDiscountTotal:w,totalWithoutDiscounts:S}){const[O,C]=i.useState(b||[]),[f,v]=i.useState(F||0),[L,R]=i.useState(!1),[K,A]=i.useState([]),[x,M]=i.useState([]),[B,Y]=i.useState(!1),[de,ee]=i.useState(null),[s,z]=i.useState(null),U=y.length===0;i.useEffect(()=>{if(y.length>0&&a>0)_();else{const d=[];C(d),v(0),A([]),M([]),n&&n(d),w&&w(0)}},[y,a]);const _=async()=>{R(!0);try{const d=y.reduce((u,N)=>u+(N.quantity||0),0);console.log("ðŸ›’ CartStepSF applying discounts:",{cart:y,subTotal:a,totalWithoutDiscounts:S,totalQuantity:d,cartLength:y.length,cartItems:y.map(u=>({id:u.id||u.item_id,name:u.name,quantity:u.quantity,price:u.price||u.final_price,category_id:u.category_id}))});const m=await ye.applyToCart(y,S);if(console.log("ðŸ“¥ Server response:",{success:m.success,data:m.data,error:m.error,fullResult:m}),m.success&&m.data){console.log("âœ… Discounts found:",m.data.applied_discounts);const u=ye.formatDiscounts(m.data.applied_discounts),N=m.data.total_discount||0,V=ye.getFreeItems(m.data.applied_discounts),I=[];m.data.applied_discounts.forEach(h=>{h.suggested_items&&Array.isArray(h.suggested_items)&&I.push(...h.suggested_items)}),C(u),v(N),A(V),M(I),n&&n(u),w&&w(N)}else{console.error("âŒ Discount application failed:",{error:m.error,success:m.success,data:m.data,fullResult:m});const u=[],N=0;C(u),v(N),A([]),M([]),n&&n(u),w&&w(N)}}catch(d){console.error("Error applying discount rules:",d);const m=[],u=0;C(m),v(u),A([]),M([]),n&&n(m),w&&w(u)}finally{R(!1)}},me=d=>x.some(m=>m.item_id===d||m.triggering_item_id===d),se=d=>x.find(m=>m.item_id===d||m.triggering_item_id===d),Q=d=>{const m=se(d.id);m&&(ee(m),z(d),Y(!0))},te=async d=>{try{console.log("CartStepSF - handleAddPromotionalItem received:",d),console.log("CartStepSF - current cart:",y),P(m=>{console.log("CartStepSF - old cart before update:",m);const u=m.findIndex(N=>(N.item_id||N.id)===d.item_id);if(console.log("CartStepSF - existingItemIndex:",u),u!==-1){const N=[...m],V=d.quantity||d.suggested_quantity||1;return console.log("CartStepSF - adding quantity:",V),N[u].quantity+=V,console.log("CartStepSF - updated cart:",N),N}else{console.log("CartStepSF - item not found, creating new product");const N={id:d.item_id,name:d.item_name,quantity:d.quantity||d.suggested_quantity||1,price:d.value||0,final_price:d.value||0,image:d.item_image||"default.jpg",brand:{name:d.item_brand||"N/A"},sku:d.item_sku||"PROMO",stock:999};return[...m,N]}}),setTimeout(()=>{_()},100)}catch(m){console.error("Error adding promotional item:",m)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:U?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-gray-500",children:"Â¡Explora nuestros productos y encuentra algo especial!"})]}):y.map((d,m)=>e.jsx(We,{...d,setCart:P,hasPromotion:me(d.id),onPromotionClick:Q},m))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(a)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(q)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"EnvÃ­o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(T)]})]}),L&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!L&&O.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-bold customtext-neutral-dark mb-2",children:"ðŸŽ‰ Descuentos aplicados:"}),O.map((d,m)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[d.name,d.description&&e.jsx("span",{className:"text-xs font-semibold block",children:d.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",k(d.amount)]})]},m)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",k(f)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(c)]})]}),f>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",k(S||c+f)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras S/ ",k(f)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Fe,{onClick:j,disabled:U,className:`w-full rounded-2xl xl:rounded-3xl ${(g==null?void 0:g.class_button)||"text-white"}`,children:U?"Carrito VacÃ­o":"Continuar Compra"}),e.jsx(Ie,{href:"/",className:"w-full rounded-2xl xl:rounded-3xl",children:U?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>E&&E(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>E&&E(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})})]})]}),e.jsx(Ye,{isOpen:B,onClose:()=>Y(!1),suggestion:de,onAddToCart:te,productName:(s==null?void 0:s.name)||""})]})}const as=g=>new Promise(async(y,P)=>{try{console.log("Datos para MercadoPago:",g);const{status:j,result:a}=await W.Fetch("./api/mercadopago/preference",{method:"POST",body:JSON.stringify(g)});if(!j||!a.preference_id){W.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(a==null?void 0:a.message)||"Error al crear la preferencia de pago",type:"danger"}),P((a==null?void 0:a.message)||"Error al crear la preferencia de pago");return}console.log("âœ… Preferencia creada:",a);const T=new window.MercadoPago(a.public_key,{locale:"es-PE"});setTimeout(()=>{window.location.href=a.redirect_url},500),y(a)}catch(j){console.error("Error en processMercadoPagoPayment:",j),W.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:j.message||"Error en la integraciÃ³n con MercadoPago",type:"danger"}),P(j.message||"Error en la integraciÃ³n con MercadoPago")}});function os({isOpen:g,onClose:y,onPaymentComplete:P,contacts:j=[]}){const[a,T]=i.useState(null),[q,c]=i.useState(!1);i.useEffect(()=>{g||(c(!1),T(null))},[g]);const E=()=>{a&&(c(!0),P(a))},b=q||!a,n=j==null?void 0:j.find(F=>F.correlative==="checkout_mercadopago");return e.jsx(Te,{isOpen:g,onRequestClose:y,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[e.jsx("div",{className:"hidden md:block bg-[#f8f5f2] h-full",children:e.jsx("img",{src:`/assets/img/${ue.APP_CORRELATIVE}/portadapagos.png`,alt:"MÃ©todos de pago",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"p-6 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center ",children:[e.jsxs("div",{className:"mb-0 md:mb-4",children:[e.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold customtext-primary",children:"Â¿CÃ³mo deseas pagar tu pedido?"}),e.jsx("p",{className:"mt-2 text-sm 2xl:text-base",children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),(n==null?void 0:n.description)!=="true"&&re.get("checkout_dwallet")!=="true"&&re.get("checkout_transfer")!=="true"?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"Sin opciones de pago"}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-3 space-y-3",children:[(n==null?void 0:n.description)=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${a==="tarjeta"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>T("tarjeta"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:a==="tarjeta",onChange:()=>T("tarjeta"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"tarjeta",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Renueva tus espacios con estilo: Fundas exclusivas para cada temporada."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${a==="tarjeta"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${a==="tarjeta"?"bg-white":""}`})})})]})}),re.get("checkout_dwallet")=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${a==="yape"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>T("yape"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:a==="yape",onChange:()=>T("yape"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"yape",className:"font-medium text-base 2xl:text-lg",children:"Yape / Plin"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Realiza el pago desde tu celular sin comisiones."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${a==="yape"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${a==="yape"?"bg-white":""}`})})})]})}),re.get("checkout_transfer")=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${a==="transferencia"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>T("transferencia"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:a==="transferencia",onChange:()=>T("transferencia"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"transferencia",className:"font-medium text-base 2xl:text-lg",children:"Pago por Transferencia"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Haz una transferencia bancaria desde tu app o banca por internet."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${a==="transferencia"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${a==="transferencia"?"bg-white":""}`})})})]})})]})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[((n==null?void 0:n.description)==="true"||re.get("checkout_dwallet")==="true"||re.get("checkout_transfer")==="true")&&e.jsx("button",{className:`w-full bg-primary hover:bg-primary text-white py-3 rounded-3xl text-base 2xl:text-lg leading-normal font-medium transition-colors 
                            ${b?"opacity-70 cursor-not-allowed":""}`,onClick:E,disabled:q,children:q?"Procesando...":"Confirmar pago"}),e.jsx("button",{className:"w-full border border-primary text-primary hover:bg-[#f8f5f2] py-3 text-base 2xl:text-lg leading-normal rounded-3xl font-medium transition-colors",onClick:y,disabled:q,children:"Volver"})]})]})]})})}const is=new Xe;function ls({cart:g,setSale:y,setCode:P,setDelivery:j,setCart:a,onContinue:T,noContinue:q,subTotal:c,igv:E,totalFinal:b,user:n,setEnvio:F,envio:w,prefixes:S,ubigeos:O=[],contacts:C,totalPrice:f,descuentofinal:v,setDescuentoFinal:L,data:R,openModal:K}){var ke,_e;const A=i.useRef(null),[x,M]=i.useState(null),[B,Y]=i.useState(null),[de,ee]=i.useState(null),[s,z]=i.useState({name:(n==null?void 0:n.name)||"",lastname:(n==null?void 0:n.lastname)||"",email:(n==null?void 0:n.email)||"",phone_prefix:(n==null?void 0:n.phone_prefix)||"51",phone:(n==null?void 0:n.phone)||"",department:(n==null?void 0:n.department)||"",province:(n==null?void 0:n.province)||"",district:(n==null?void 0:n.district)||"",address:(n==null?void 0:n.address)||"",number:(n==null?void 0:n.number)||"",comment:(n==null?void 0:n.comment)||"",shippingOption:"delivery",ubigeo:(n==null?void 0:n.ubigeo)||null,invoiceType:(n==null?void 0:n.invoiceType)||"boleta",documentType:(n==null?void 0:n.documentType)||"dni",document:(n==null?void 0:n.dni)||"",businessName:(n==null?void 0:n.businessName)||""});i.useEffect(()=>{if(n!=null&&n.ubigeo&&(n!=null&&n.district)&&(n!=null&&n.province)&&(n!=null&&n.department)){const t={value:n.ubigeo,label:`${n.district}, ${n.province}, ${n.department}`,data:{reniec:n.ubigeo,departamento:n.department,provincia:n.province,distrito:n.district}};ee(t),Y(t),ge(t)}},[n]);const U=t=>{var r;return((r=C.find(l=>l.correlative===t))==null?void 0:r.description)||""},_=t=>{const{name:r,value:l}=t.target;z(o=>({...o,[r]:l})),r==="invoiceType"&&z(o=>({...o,documentType:l==="factura"?"ruc":"dni",document:"",businessName:l==="factura"?o.businessName:""}))},[me,se]=i.useState(0),[Q,te]=i.useState(!1),[d,m]=i.useState([]),[u,N]=i.useState(null),[V,I]=i.useState(null),[h,J]=i.useState({}),he=typeof c=="number"?c:parseFloat(c)||0,pe=typeof E=="number"?E:parseFloat(E)||0,X=parseFloat(U("shipping_free")),be=he+pe-v,ge=async t=>{var l;if(!t)return;J(o=>({...o,ubigeo:""}));const{data:r}=t;console.log("data",r),z(o=>({...o,department:r.departamento,province:r.provincia,district:r.distrito,ubigeo:r.reniec||r.inei})),te(!0);try{const o=await Je.getShippingCost({ubigeo:r.reniec||r.inei}),p=[],H=be>=X;if(H?p.push({type:"free",price:0,description:`Compra mayor a S/ ${X}`,deliveryType:"EnvÃ­o gratuito"}):o.data.is_free?p.push({type:"free",price:0,description:o.data.standard.description,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics}):o.data.is_agency?p.push({type:"agency",price:0,description:o.data.agency.description,deliveryType:o.data.agency.type,characteristics:o.data.agency.characteristics}):p.push({type:"standard",price:o.data.standard.price,description:o.data.standard.description,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics}),((l=o.data.express)==null?void 0:l.price)>0&&o.data.is_free&&!H&&p.push({type:"express",price:o.data.express.price,description:o.data.express.description,deliveryType:o.data.express.type,characteristics:o.data.express.characteristics}),p.length===0)throw new Error("No hay opciones de envÃ­o disponibles");m(p),N(p[0].type),F(p[0].price)}catch(o){console.error("Error al obtener precios de envÃ­o:",o),le.success("Sin cobertura",{description:"No realizamos envÃ­os a esta ubicaciÃ³n",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"}),m([]),N(null),F(0)}te(!1)};i.useEffect(()=>{B&&ge(B)},[g,c,v]);const qe=i.useCallback(De.debounce((t,r)=>{if(t.length<3){r([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(l=>{if(!l.ok)throw new Error("Error en la respuesta");return l.json()}).then(l=>{const o=l.map(p=>({value:p.reniec,label:`${p.distrito}, ${p.provincia}, ${p.departamento}`,data:{inei:p.inei,reniec:p.reniec,departamento:p.departamento,provincia:p.provincia,distrito:p.distrito}}));r(o)}).catch(l=>{console.error("Error:",l),r([])})},300),[]);i.useEffect(()=>{const t=r=>{const l=r.element.dataset.code,o=r.element.dataset.flag;return Ze.renderToString(e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-8 font-emoji text-center",children:o}),e.jsx("b",{className:"me-1",children:r.text}),e.jsx("span",{className:"text-sm text-opacity-20",children:l})]}))};$(".select2-prefix-selector").select2({dropdownCssClass:"py-1",containerCssClass:"!border !border-gray-300 !rounded p-2 !h-[42px]",arrowCssClass:'!text-primary top-1/2 -translate-y-1/2"',templateResult:function(r){if(!r.id)return r.text;var l=$(t(r));return l},templateSelection:function(r){if(!r.id)return r.text;var l=$(t(r));return l},matcher:function(r,l){if(!r.term||!l.element)return l;const o=l.element.dataset.country||"",p=l.text||"";return o.toLowerCase().includes(r.term.toLowerCase())||p.toLowerCase().includes(r.term.toLowerCase())?l:null}})},[s.phone_prefix]);const[Oe,fe]=i.useState(!1),[Le,je]=i.useState(!1),[Re,ve]=i.useState(!1),[Ne,Me]=i.useState(null),[we,Ce]=i.useState(null),Ae=t=>{if(t.preventDefault(),t&&t.preventDefault&&t.preventDefault(),!!Be()){if(!u){le.success("Seleccione envÃ­o",{description:"Debe elegir un mÃ©todo de envÃ­o",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"});return}fe(!0)}},Be=()=>{const t={};s.name||(t.name="Nombre es requerido"),s.lastname||(t.lastname="Apellido es requerido"),s.email||(t.email="Email es requerido"),s.phone||(t.phone="TelÃ©fono es requerido"),s.ubigeo||(t.ubigeo="Ubigeo es requerido"),s.address||(t.address="DirecciÃ³n es requerida"),s.document||(t.document="Documento es requerido"),s.number||(t.number="Numero es requerido"),J(t);const r=(l,o=800)=>{const p=l.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/2+l.offsetHeight/2,H=window.pageYOffset;let Z=null;const xe=ae=>{Z===null&&(Z=ae);const oe=ae-Z,ie=((D,Pe,Ee,He)=>(D/=He/2,D<1?Ee/2*D*D+Pe:(D--,-Ee/2*(D*(D-2)-1)+Pe)))(oe,H,p-H,o);window.scrollTo(0,ie),oe<o?requestAnimationFrame(xe):["INPUT","SELECT","TEXTAREA"].includes(l.tagName)&&l.focus()};requestAnimationFrame(xe)};if(Object.keys(t).length>0){const l=Object.keys(t)[0];setTimeout(()=>{var p;let o=null;l==="ubigeo"?o=document.getElementById("ubigeo-select-container"):l==="phone_prefix"?o=(p=document.querySelector(".select2-prefix-selector"))==null?void 0:p.parentElement:o=document.querySelector(`[name="${l}"]`),o&&(o.classList.add("highlight-error"),setTimeout(()=>o.classList.remove("highlight-error"),2e3),r(o,600))},100)}return Object.keys(t).length===0},ze=async t=>{try{if(fe(!1),Me(t),t==="tarjeta"){if(!window.MercadoPago){console.error("âŒ MercadoPago aÃºn no se ha cargado.");return}const r={user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,phone_prefix:(s==null?void 0:s.phone_prefix)||"51",email:(s==null?void 0:s.email)||"",phone:`${s.phone_prefix}${s.phone}`,country:"PerÃº",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",ubigeo:(s==null?void 0:s.ubigeo)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",amount:f||0,delivery:w,cart:g,invoiceType:s.invoiceType||"",documentType:s.documentType||"",document:s.document||"",businessName:s.businessName||"",payment_method:t||null,coupon_id:x?x.id:null,coupon_discount:v||0,total_amount:b||0};try{const o=await as(r);o.status?(y(o.sale),j(o.delivery),P(o.code)):le.success("Error en el Pago",{description:"El pago ha sido rechazado",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}catch(l){console.log(l),le.success("Error en el Pago",{description:"No se llegÃ³ a procesar el pago",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}}else if(t==="yape"){const r={user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,phone_prefix:(s==null?void 0:s.phone_prefix)||"51",email:(s==null?void 0:s.email)||"",phone:`${s.phone_prefix}${s.phone}`,country:"PerÃº",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",ubigeo:(s==null?void 0:s.ubigeo)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",amount:f||0,delivery:w,cart:g,invoiceType:s.invoiceType||"",documentType:s.documentType||"",document:s.document||"",businessName:s.businessName||"",payment_method:t||null,payment_proof:null,coupon_id:x?x.id:null,coupon_discount:v||0,total_amount:b||0};Ce(r),je(!0)}else if(t==="transferencia"){const r={user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,phone_prefix:(s==null?void 0:s.phone_prefix)||"51",email:(s==null?void 0:s.email)||"",phone:`${s.phone_prefix}${s.phone}`,country:"PerÃº",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",ubigeo:(s==null?void 0:s.ubigeo)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",amount:f||0,delivery:w,cart:g,invoiceType:s.invoiceType||"",documentType:s.documentType||"",document:s.document||"",businessName:s.businessName||"",payment_method:t||null,payment_proof:null,coupon_id:x?x.id:null,coupon_discount:v||0,total_amount:b||0};Ce(r),ve(!0)}}catch(r){console.error("Error en el pago:",r),le.success("Error en el Pago",{description:"No se llegÃ³ a procesar el pago",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}};i.useEffect(()=>{J(t=>{const r={...t};return Object.keys(s).forEach(l=>{s[l]&&delete r[l]}),r})},[s]);const Ue=t=>({control:r=>({...r,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:r=>({...r,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:r=>({...r,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})});i.useEffect(()=>{if(x){let t=0;x.type==="percentage"?t=f*(x.amount/100):t=x.amount,L(t)}else L(0)},[f,x]);const Se=t=>{t.preventDefault();const r=(A.current.value||"").trim().toUpperCase();r&&is.save({coupon:r,amount:f,email:"basiliohinostroza2003bradneve@gmail.com"}).then(l=>{l&&l.id?M(l):(M(null),L(0))})},Ve=t=>{t.key=="Enter"&&Se(t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 lg:gap-8 ",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-6 bg-[#f9f9f9] py-6 px-4 sm:px-6 rounded-2xl font-font-general",onSubmit:t=>t.preventDefault(),children:[e.jsxs("div",{className:"sectionInformation space-y-3.5",children:[e.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark ",children:"InformaciÃ³n del contacto"}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsx(G,{type:"text",label:"Nombres",name:"name",value:s.name,error:h.name,onChange:_,placeholder:"Nombres",required:!0}),e.jsx(G,{label:"Apellidos",type:"text",name:"lastname",value:s.lastname,error:h.lastname,onChange:_,placeholder:"Apellidos",required:!0})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[e.jsx(G,{label:"Correo electrÃ³nico",type:"email",name:"email",value:s.email,error:h.email,onChange:_,placeholder:"Ej. hola@gmail.com",required:!0}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark",children:["Celular ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("div",{className:"max-w-[120px]",children:e.jsx(es,{name:"phone_prefix",value:S.find(t=>t.realCode===s.phone_prefix)?{value:S.find(t=>t.realCode===s.phone_prefix).realCode,label:`${S.find(t=>t.realCode===s.phone_prefix).beautyCode}`,flag:S.find(t=>t.realCode===s.phone_prefix).flag,code:S.find(t=>t.realCode===s.phone_prefix).beautyCode,country:S.find(t=>t.realCode===s.phone_prefix).country}:null,onChange:t=>z(r=>({...r,phone_prefix:(t==null?void 0:t.value)||""})),options:S.sort((t,r)=>t.country.localeCompare(r.country)).map(t=>({value:t.realCode,label:t.beautyCode,flag:t.flag,code:t.beautyCode,country:t.country})),formatOptionLabel:({flag:t,code:r,country:l})=>{var ae,oe;const o=S.find(ne=>ne.country===l),p=((oe=(ae=o==null?void 0:o.isoCode)==null?void 0:ae.ISO1)==null?void 0:oe.toLowerCase())||l.toLowerCase().substring(0,2),H=[`https://flagsapi.com/${p.toUpperCase()}/flat/24.png`,`https://flagcdn.com/${p}.svg`,`https://purecatamphetamine.github.io/country-flag-icons/3x2/${p.toUpperCase()}.svg`,`https://cdn.jsdelivr.net/gh/hampusborgos/country-flags@main/svg/${p}.svg`,`https://raw.githubusercontent.com/lipis/flag-icons/main/flags/4x3/${p}.svg`];let Z=0;const xe=ne=>{if(Z++,Z<H.length)ne.target.src=H[Z];else{ne.target.style.display="none";const ie=ne.target.nextElementSibling;ie&&ie.classList.contains("flag-fallback")&&(ie.style.display="flex")}};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:H[0],alt:`Bandera de ${l}`,className:"w-6 h-4 object-cover rounded-sm flex-shrink-0 border border-gray-200",onError:xe,style:{minWidth:"24px",minHeight:"16px"}}),e.jsx("div",{className:"flag-fallback w-6 h-4 bg-gray-200 rounded-sm flex items-center justify-center flex-shrink-0 border border-gray-300",style:{display:"none",minWidth:"24px",minHeight:"16px"},children:e.jsx("span",{className:"text-xs text-gray-500",children:p.toUpperCase()})}),e.jsx("span",{className:"font-medium text-sm",children:r})]})},placeholder:"PaÃ­s",isClearable:!1,isSearchable:!0,styles:{control:t=>({...t,minHeight:"48px",border:"1px solid #d1d5db",borderRadius:"0.75rem",fontSize:"14px","&:hover":{borderColor:"#9ca3af"},"&:focus-within":{borderColor:"#3b82f6",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.1)"}}),option:(t,r)=>({...t,backgroundColor:r.isSelected?"#3b82f6":r.isFocused?"#f3f4f6":"white",color:r.isSelected?"white":"#374151",padding:"8px 12px"}),singleValue:t=>({...t,display:"flex",alignItems:"center",gap:"6px"}),menu:t=>({...t,zIndex:9999})},filterOption:(t,r)=>t.data.country.toLowerCase().includes(r.toLowerCase())||t.data.code.toLowerCase().includes(r.toLowerCase())})}),e.jsx("div",{className:"flex-1",children:e.jsx(G,{type:"text",id:"phone",name:"phone",value:s.phone,error:h.phone,onChange:_,placeholder:"000 000 000"})})]})]})]})]}),e.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),e.jsxs("div",{className:"sectionDelivery space-y-3.5",children:[e.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"DirecciÃ³n de envÃ­o"}),e.jsxs("div",{id:"ubigeo-select-container",className:"form-group",children:[e.jsx("label",{className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark ",children:"UbicaciÃ³n de entrega (Distrito)"}),e.jsx(Ke,{name:"ubigeo",cacheOptions:!0,value:B,loadOptions:qe,onChange:t=>{Y(t),ge(t)},placeholder:"Buscar por distrito | provincia | departamento ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Ingrese al menos 3 caracteres...":"No se encontraron resultados",isLoading:Q,styles:Ue(!!h.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0,components:{ClearIndicator:t=>e.jsx("div",{...t.innerProps,className:"p-1 cursor-pointer",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400 hover:text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}}),h.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:h.ubigeo})]}),e.jsx(G,{label:"Avenida / Calle / JirÃ³n",type:"text",name:"address",value:s.address,error:h.address,onChange:_,placeholder:"Ingresa el nombre de la calle",required:!0}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsx(G,{label:"NÃºmero",type:"text",name:"number",value:s.number,error:h.number,onChange:_,placeholder:"Ingresa el nÃºmero de la calle",required:!0}),e.jsx(G,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque (opcional)",type:"text",name:"comment",value:s.comment,onChange:_,placeholder:"Ej. Casa 3, Dpto 101"})]}),d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"MÃ©todo de envÃ­o"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:d.map(t=>e.jsx(Qe,{title:(t.type==="free"||t.type==="express"||t.type==="agency",t.deliveryType),price:t.price,description:t.description,selected:u===t.type,onSelect:()=>{N(t.type),F(t.price)}},t.type))}),console.log(d.find(t=>t.type===u)),u&&d.length>0&&e.jsx("div",{className:"space-y-4 mt-4",children:(_e=(ke=d.find(t=>t.type===u))==null?void 0:ke.characteristics)==null?void 0:_e.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-4 bg-[#F7F9FB] p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info customtext-primary",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:t})})]},`char-${r}`))})]})]}),e.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Tipo de comprobante"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio",name:"invoiceType",value:"boleta",checked:s.invoiceType==="boleta",onChange:_}),e.jsx("span",{className:"ml-2",children:"Boleta"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio",name:"invoiceType",value:"factura",checked:s.invoiceType==="factura",onChange:_}),e.jsx("span",{className:"ml-2",children:"Factura"})]})]})]}),e.jsx(G,{label:s.documentType==="dni"?"DNI":"RUC",type:"text",name:"document",value:s.document,error:h.document,onChange:_,placeholder:`Ingrese su ${s.documentType==="dni"?"DNI":"RUC"}`,maxLength:s.documentType==="dni"?"8":"11",required:!0}),s.invoiceType==="factura"&&e.jsx(G,{label:"RazÃ³n Social",type:"text",name:"businessName",value:s.businessName,onChange:_,placeholder:"Ingrese la razÃ³n social"})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max font-font-general",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6 customtext-neutral-dark",children:"Resumen de compra"}),e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:g.map((t,r)=>e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-0 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${t.image}`,alt:t.name,className:"w-20 h-20 object-cover rounded  "})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold customtext-neutral-dark text-base 2xl:text-lg mb-2",children:t.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:t.color})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",e.jsxs("span",{className:"customtext-neutral-dark",children:[t.quantity," "]})]})]})]})},t.id))}),!x&&e.jsxs("div",{className:"mt-6 flex",children:[e.jsx("input",{ref:A,type:"text",placeholder:"CÃ³digo de cupÃ³n",className:"w-full rounded-l-md border border-gray-300 py-3 px-4 text-sm outline-none uppercase focus:border-[#C5B8D4]",value:x==null?void 0:x.name,onKeyDown:Ve,disabled:Q}),e.jsx("button",{className:`rounded-r-md px-4 py-2 text-sm text-white transition-all duration-300 hover:opacity-90 ${R!=null&&R.gradient?"bg-gradient":"bg-primary"}`,type:"button",onClick:Se,disabled:Q,children:"Aplicar"})]}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(c)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(E)]})]}),x&&e.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[e.jsxs("span",{children:["CupÃ³n aplicado"," ",e.jsx($e,{content:"Eliminar",children:e.jsx("i",{className:"mdi mdi-close text-red-500 cursor-pointer",onClick:()=>{M(null),A.current.value=""}})}),e.jsxs("small",{className:"block text-xs font-light",children:[x.name," ",e.jsx($e,{content:x.description,children:e.jsx("i",{className:"mdi mdi-information-outline ms-1"})})," ","(",x.type==="percentage"?`-${Math.round(x.amount*100)/100}%`:`S/ -${k(x.amount)}`,")"]})]}),e.jsxs("span",{children:["S/ -",k(v)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"EnvÃ­o"}),e.jsx("span",{className:"font-semibold",children:X!=null&&be>=X?e.jsxs("span",{className:"customtext-neutral-dark",children:["Gratis (Compra mayor a S/",X,")"]}):`S/ ${k(w)}`})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(b)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx("button",{className:`w-full py-3 px-6 rounded-full font-semibold text-lg transition-all duration-300 hover:opacity-90 bg-primary ${(R==null?void 0:R.class_button)||" text-white"}`,onClick:Ae,children:"Continuar"}),e.jsx("div",{id:"mercadopago-button-container"}),e.jsx(Ie,{className:"!rounded-full",onClick:q,children:"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",e.jsx("a",{href:"#",onClick:()=>K&&K(1),className:"customtext-primary font-bold",children:" TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",e.jsx("a",{href:"#",onClick:()=>K&&K(0),className:"customtext-primary font-bold",children:" PolÃ­tica de Privacidad"}),"."]})})]})]})]}),e.jsx(os,{isOpen:Oe,contacts:C,onClose:()=>fe(!1),onPaymentComplete:ze}),e.jsx(ss,{isOpen:Le,cart:g,subTotal:c,igv:E,totalFinal:b,envio:w,request:we,onClose:()=>je(!1),paymentMethod:Ne,coupon:x,descuentofinal:v}),e.jsx(ts,{isOpen:Re,cart:g,subTotal:c,igv:E,totalFinal:b,envio:w,contacts:C,request:we,onClose:()=>ve(!1),paymentMethod:Ne,coupon:x,descuentofinal:v})]})}const cs=({code:g})=>new Promise(async(y,P)=>{try{console.log("Codigo de venta:",g);const{status:j,result:a}=await W.Fetch("./api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g})});if(!j||!a.order){W.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(a==null?void 0:a.message)||"Error no se pudo cargar la orden",type:"danger"}),P((a==null?void 0:a.message)||"Error no se pudo cargar la orde");return}y(a)}catch(j){console.error("Error en processMercadoPagoPayment:",j),W.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:j.message||"Error en la integraciÃ³n con MercadoPago",type:"danger"}),P(j.message||"Error en la integraciÃ³n con MercadoPago")}});function ds({setCart:g,cart:y,code:P,delivery:j}){var O;const[a,T]=i.useState(null),[q,c]=i.useState(!0),[E,b]=i.useState(null);if(i.useEffect(()=>{P&&((async()=>{try{const f=await cs({code:P});T(f.order)}catch(f){b(f.message)}finally{c(!1)}})(),W.Local.delete(`${ue.APP_CORRELATIVE}_cart`),W.Local.set(`${ue.APP_CORRELATIVE}_cart`,[]))},[P]),q)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:e.jsx("p",{children:"Cargando detalles de la orden..."})})});if(E)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center text-red-500",children:e.jsxs("p",{children:["Error al cargar la orden: ",E]})})});if(!a)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:e.jsx("p",{children:"No se encontraron datos de la orden"})})});const F=((((O=a==null?void 0:a.items)==null?void 0:O.reduce((C,f)=>{const v=f.price||0,L=f.quantity||0;return C+v*L},0))||0)/1.18).toFixed(2),w=(F*.18).toFixed(2),S=parseFloat(F)+parseFloat(w)+parseFloat(a.delivery)-parseFloat(a.coupon_discount||0);return console.log(a.delivery,"order.coupon_discount"),e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-base xl:text-xl customtext-neutral-light",children:"Gracias por tu compra ðŸŽ‰"}),e.jsx("p",{className:"customtext-neutral-dark text-2xl xl:text-5xl font-semibold",children:"Tu orden ha sido recibida"}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:" customtext-neutral-light",children:"CÃ³digo de pedido"}),e.jsxs("div",{className:"customtext-neutral-dark text-lg font-semibold",children:["#",a.code]})]}),e.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:a.items.map((C,f)=>e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl w-max",children:e.jsx("img",{src:C.image?`/storage/images/item/${C.image}`:"/assets/img/noimage/no_img.jpg",alt:C.name,className:"w-20 h-20 object-cover rounded",onError:v=>v.target.src="/assets/img/noimage/no_img.jpg"})}),e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"font-medium text-lg",children:C.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",e.jsx("span",{className:"customtext-neutral-dark",children:C.color})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark",children:parseInt(C.quantity)})," - Precio: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[" S/ ",k(C.price)]})]})]})]})},f))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(F)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(w)]})]}),a.coupon_id&&e.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[e.jsxs("span",{children:["CupÃ³n aplicado"," "]}),e.jsxs("span",{children:["S/ -",k(a.coupon_discount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"EnvÃ­o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(a.delivery)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(S)]})]})})]}),e.jsx("div",{className:"pt-3",children:e.jsx(Fe,{href:"/catalogo",children:"  Seguir Comprando"})})]})]})})})}function it({cart:g,setCart:y,user:P,prefixes:j,ubigeos:a,items:T,contacts:q,data:c,generals:E=[]}){const[b,n]=i.useState(1),[F,w]=i.useState(0),S=g.reduce((I,h)=>{const J=h.final_price;return I+J*h.quantity},0),[O,C]=i.useState(0),f=parseFloat((S/1.18).toFixed(2)),v=parseFloat((S-f).toFixed(2)),[L,R]=i.useState(0),[K,A]=i.useState(null),[x,M]=i.useState([]),[B,Y]=i.useState(0),[de,ee]=i.useState(null),s=I=>ee(I),z=()=>ee(null),U={privacy_policy:"PolÃ­ticas de privacidad",terms_conditions:"TÃ©rminos y condiciones",saleback_policy:"PolÃ­ticas de devolucion y cambio"},_=f+v+parseFloat(O),me=L+B+F,se=Math.max(0,_-me),[Q,te]=i.useState([]),[d,m]=i.useState([]),[u,N]=i.useState([]);i.useEffect(()=>{const h=new URLSearchParams(window.location.search).get("code");h&&(m(h),n(3))},[window.location.search]),i.useEffect(()=>{d&&W.Local.delete(`${ue.APP_CORRELATIVE}_cart`)},[d]),i.useEffect(()=>{(()=>{const h=document.createElement("script");h.src="https://sdk.mercadopago.com/js/v2",h.async=!0,document.body.appendChild(h)})()},[]);const V=I=>{n(I),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${b===1?`${c!=null&&c.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${c!=null&&c.gradient?"bg-gradient border-transparent text-white":"bg-primary text-white border-primary"}`,children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${c!=null&&c.gradient?"bg-gradient":"bg-primary"}`,style:{width:b>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${b>1?`${c!=null&&c.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${b>1?c!=null&&c.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":c!=null&&c.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"EnvÃ­o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${c!=null&&c.gradient?"bg-gradient":"bg-primary"}`,style:{width:b>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${b===3?`${c!=null&&c.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${b===3?c!=null&&c.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":c!=null&&c.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"ConfirmaciÃ³n"})]})]})}),b===1&&e.jsx(rs,{data:c,cart:g,setCart:y,onContinue:()=>V(2),subTotal:f,totalPrice:S,envio:O,igv:v,totalFinal:se,openModal:s,automaticDiscounts:x,setAutomaticDiscounts:M,automaticDiscountTotal:B,setAutomaticDiscountTotal:Y,totalWithoutDiscounts:_}),b===2&&e.jsx(ls,{data:c,setCode:m,setDelivery:N,cart:g,setSale:te,setCart:y,onContinue:()=>V(3),noContinue:()=>V(1),subTotal:f,totalPrice:S,envio:O,setEnvio:C,igv:v,totalFinal:se,user:P,prefixes:j,contacts:q,ubigeos:a,items:T,descuentofinal:F,setDescuentoFinal:w,openModal:s,setCouponDiscount:R,setCouponCode:A,automaticDiscounts:x,setAutomaticDiscounts:M,automaticDiscountTotal:B,setAutomaticDiscountTotal:Y,totalWithoutDiscounts:_}),b===3&&e.jsx(ds,{data:c,code:d,setCart:y,delivery:u,cart:Q,subTotal:f,totalPrice:S,envio:O,igv:v,totalFinal:se,descuentofinal:F,setDescuentoFinal:w,couponDiscount:L,couponCode:K,automaticDiscounts:x,automaticDiscountTotal:B,totalWithoutDiscounts:_})]}),Object.keys(U).map((I,h)=>{var pe;const J=U[I],he=((pe=E.find(X=>X.correlative==I))==null?void 0:pe.description)??"";return e.jsx(Te,{isOpen:de===h,onRequestClose:z,contentLabel:J,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:J}),e.jsx("button",{onClick:z,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(ns,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(Ge,{html:he})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:z,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},h)})]})}export{it as default};
