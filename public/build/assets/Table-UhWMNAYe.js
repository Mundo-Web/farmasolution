var S=Object.defineProperty;var N=(r,s,l)=>s in r?S(r,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[s]=l;var C=(r,s,l)=>N(r,typeof s!="symbol"?s+"":s,l);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{r as h}from"./index-BOnQTV8N.js";import{F as n,h as F}from"./CreateReactScript-Bw0vifCy.js";import{M}from"./Modal-BYL-UsqM.js";import{m as B}from"./main-DKOTUah5.js";import{t as D,T as O}from"./index-DRg3WPTA.js";class z{constructor(){C(this,"save",async(s,l)=>{try{const{status:d,result:c}=await B.Fetch(`/api/admin/fillable/${s}`,{method:"POST",body:JSON.stringify(l)});if(!d)throw new Error((c==null?void 0:c.message)??"Ocurrió un error inesperado");return c.data??!0}catch(d){return D.error("¡Error!",{description:d.message,duration:3e3,position:"bottom-center",richColors:!0}),null}})}}const P=new z,A=({gridRef:r,pageSize:s=10,rest:l,columns:d,toolBar:c,masterDetail:f,filterValue:m,exportable:x,exportableName:b,customizeCell:v=()=>{},onRefresh:g=()=>{}})=>{const p=h.useRef(),[w,j]=h.useState(!1),[u,E]=h.useState(n.models[0]??null),R=async e=>{e.preventDefault();const a=document.querySelectorAll(`input[type="checkbox"][id^="fillable-ck-${u}"]`),o=Array.from(a).reduce((y,k)=>(y[k.value]=k.checked,y),{});j(!0);const i=await P.save(u,o);j(!1),i&&n.set(u,i)};return h.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(r.current).dxDataGrid({language:"es",dataSource:{load:async e=>{const a=await l.paginate({...e});return g(a),a}},onToolbarPreparing:e=>{const{items:a}=e.toolbarOptions;F("Root")&&n.models.length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-cog",hint:"Configurar campos",text:"Configurar",onClick:()=>$(p.current).modal("show")}}),c(a)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:m,export:{enabled:x},onExporting:function(e){var a=new ExcelJS.Workbook,o=a.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:o,component:e.component,customizeCell:function(i){v(i),i.excelCell.alignment={horizontal:"left",vertical:"top",...i.excelCell.alignment}},includeHiddenColumns:!0}).then(function(){a.xlsx.writeBuffer().then(function(i){saveAs(new Blob([i],{type:"application/octet-stream"}),`${b}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:s},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:d,masterDetail:f,onContentReady:(...e)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),t.jsxs(t.Fragment,{children:[t.jsx(O,{}),t.jsx("div",{ref:r}),t.jsxs(M,{modalRef:p,title:"Configurar campos visibles",onSubmit:R,onClose:()=>{n.models.forEach(e=>{Object.keys(n.values[e]).forEach(a=>{const o=document.getElementById(`fillable-ck-${e}-${a}`);o&&(o.checked=n.values[e][a])})})},loading:w,children:[t.jsx("ul",{class:"nav nav-tabs nav-bordered",children:n.models.map((e,a)=>t.jsx("li",{class:"nav-item",children:t.jsx("button",{href:`#fillable-${e}`,"data-bs-toggle":"tab","aria-expanded":"false",class:`nav-link ${u==e&&"active"}`,onClick:()=>E(e),disabled:w,type:"button",children:e})},a))}),t.jsx("div",{class:"tab-content",style:{minHeight:"240px"},children:n.models.map((e,a)=>t.jsx("div",{class:`tab-pane ${u==e&&"active"}`,id:`fillable-${e}`,children:t.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:Object.keys(n.values[e]).map((o,i)=>t.jsxs("label",{class:"form-check form-check-success border cursor-pointer",htmlFor:`fillable-ck-${e}-${o}`,style:{padding:"2px 10px 2px 30px",borderRadius:"8px",userSelect:"none"},children:[t.jsx("input",{class:"form-check-input cursor-pointer",type:"checkbox",value:o,id:`fillable-ck-${e}-${o}`,defaultChecked:n.values[e][o]}),t.jsx("span",{class:"form-check-label",children:o})]},i))})},a))})]})]})},L=({title:r,gridRef:s,pageSize:l,rest:d,columns:c,toolBar:f,masterDetail:m,filterValue:x=[],onRefresh:b,exportable:v,exportableName:g,customizeCell:p=()=>{}})=>t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[typeof r=="object"?t.jsx("div",{className:"card-header",children:r}):"",t.jsxs("div",{className:"card-body",children:[typeof r!="object"?t.jsxs("h4",{className:"header-title",children:[t.jsx("div",{id:"header-title-options",className:"float-end"}),t.jsx("span",{id:"header-title-prefix"})," Lista de ",r," ",t.jsx("span",{id:"header-title-suffix"})]}):"",t.jsx(A,{gridRef:s,rest:d,pageSize:l,columns:c.filter(Boolean),toolBar:f,masterDetail:m,filterValue:x,onRefresh:b,exportable:v,exportableName:g,customizeCell:p})]})]})})});export{L as T};
