import{j as i}from"./AboutSimple-Cf8x2fCZ.js";import{r as s}from"./index-BOnQTV8N.js";import{c as Z}from"./ReactAppend-DTVVXReZ.js";import{s as N}from"./server.browser-Bf4gQIc7.js";import{L as ee,G as ie,M as re}from"./esm-B3ahtdks.js";import{S as oe}from"./StoresRest-BKz-oXK-.js";import{C as ne}from"./CreateReactScript-DlXLjWSJ.js";import{B as te}from"./Base-C40ZURYQ.js";import{T as le}from"./Table-CCZDHBJ5.js";import{M as se}from"./Modal-BYL-UsqM.js";import{I as u}from"./InputFormGroup-iZIO11ZN.js";import{T as ae}from"./TextareaFormGroup-CliirJM1.js";import{I as ce}from"./ImageFormGroup-Brimgjsn.js";import{S as H}from"./SelectFormGroup-D63EMIiA.js";import{D as q}from"./DxButton-DV0H-ZcL.js";import{S as c}from"./ProductCard-Lp5WfZrB.js";import{G as de}from"./Global-DWbVqTT_.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";import"./index-C0Swrixi.js";import"./BasicRest-BCYKfs4R.js";import"./main-DKOTUah5.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./index-DRg3WPTA.js";import"./index.esm-BNsoPXs8.js";import"./index-NIGUFBhG.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-DKJVq_mE.js";import"./tippy-react.esm-Ce0cOK54.js";import"./Logout-W0zm0J8x.js";import"./MenuItemContainer-CEON2wjZ.js";const b=new oe,pe=({ubigeos:j=[]})=>{const m=s.useRef(),S=s.useRef(),f=s.useRef(),w=s.useRef(),E=s.useRef(),T=s.useRef(),C=s.useRef(),F=s.useRef(),R=s.useRef(),g=s.useRef(),h=s.useRef(),x=s.useRef();s.useRef();const D=s.useRef(),M=s.useRef(),v=s.useRef(),[Y,P]=s.useState(!1),[z,_]=s.useState({lat:-12.046374,lng:-77.042793}),[B,y]=s.useState(null),[k,L]=s.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),G=e=>{if(console.log(e),e!=null&&e.id?P(!0):P(!1),f.current.value=(e==null?void 0:e.id)??"",w.current.value=(e==null?void 0:e.name)??"",E.current.value=(e==null?void 0:e.address)??"",T.current.value=(e==null?void 0:e.phone)??"",C.current.value=(e==null?void 0:e.email)??"",F.current.value=(e==null?void 0:e.description)??"",g.current.value=(e==null?void 0:e.latitude)??"",h.current.value=(e==null?void 0:e.longitude)??"",D.current.value=(e==null?void 0:e.manager)??"",M.current.value=(e==null?void 0:e.capacity)??"",x.current&&(x.image.src=`/storage/images/store/${(e==null?void 0:e.image)??"undefined"}`),$(R.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),e!=null&&e.id?b.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(r=>{console.log("Verificando tiendas principales para edición:",r);const o=$(v.current);if(r!=null&&r.data&&Array.isArray(r.data)&&r.data.length>0){const n=r.data.find(l=>l.id!==e.id);n?(console.log("Existe otra tienda principal:",n),e.type!=="tienda_principal"?o.find('option[value="tienda_principal"]').prop("disabled",!0):o.find('option[value="tienda_principal"]').prop("disabled",!1)):(console.log("No existe otra tienda principal"),o.find('option[value="tienda_principal"]').prop("disabled",!1))}else console.log("No hay tiendas principales"),o.find('option[value="tienda_principal"]').prop("disabled",!1);o.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(r=>{console.error("Error al verificar tiendas principales:",r),$(v.current).val((e==null?void 0:e.type)??"tienda").trigger("change")}):b.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(r=>{console.log("Verificando tiendas principales existentes:",r);const o=(r==null?void 0:r.data)&&Array.isArray(r.data)&&r.data.length>0,n=$(v.current);o?(console.log("Se encontraron tiendas principales:",r.data),n.find('option[value="tienda_principal"]').prop("disabled",!0)):(console.log("No se encontraron tiendas principales"),n.find('option[value="tienda_principal"]').prop("disabled",!1)),n.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(r=>{console.error("Error al verificar tiendas principales:",r)}),e!=null&&e.business_hours)try{const r=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;L(r)}catch(r){console.error("Error parsing business hours:",r)}else L([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);if(e!=null&&e.latitude&&(e!=null&&e.longitude)){const r=parseFloat(e.latitude),o=parseFloat(e.longitude);if(!isNaN(r)&&!isNaN(o)){const n={lat:r,lng:o};_(n),y(n)}}else _({lat:-12.046374,lng:-77.042793}),y(null);$(S.current).modal("show")},K=async e=>{if(e.preventDefault(),v.current.value==="tienda_principal")try{const a=f.current.value,p=await b.paginate({filter:JSON.stringify({type:"tienda_principal"})});if(console.log("Respuesta de validación tienda principal:",p),p!=null&&p.data&&Array.isArray(p.data)&&p.data.length>0)if(a){const J=p.data.find(X=>X.id!==a);if(J){console.log("Ya existe otra tienda principal:",J),c.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}else{console.log("Tiendas principales encontradas:",p.data),c.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}catch(a){console.error("Error al verificar tienda principal:",a),c.fire({title:"Error",text:"Error al verificar si existe una tienda principal",icon:"error"});return}const r=g.current.value.trim(),o=h.current.value.trim();let n=null,l=null;if(r){if(n=parseFloat(r),console.log("Latitud procesada:",n,"desde:",r),n<-18.5||n>-.1){c.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});return}if(!O(n,10,8)){c.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});return}n=Math.round(n*1e8)/1e8,console.log("Latitud truncada:",n)}if(o){if(l=parseFloat(o),console.log("Longitud procesada:",l,"desde:",o),l<-81.5||l>-68.5){c.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});return}if(!O(l,11,8)){c.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});return}l=Math.round(l*1e8)/1e8,console.log("Longitud truncada:",l)}j.find(a=>a.reniec==R.current.value);const t=new FormData,d=f.current.value;console.log("DEBUG ID - Valor del ID a enviar:",d,"Tipo:",typeof d,"Vacío?:",!d),f.current.value?(t.append("id",f.current.value),console.log("DEBUG ID - ID agregado al FormData:",f.current.value)):console.log("DEBUG ID - No se agrega ID al FormData (valor vacío)"),t.append("name",w.current.value),t.append("address",E.current.value),t.append("phone",T.current.value),t.append("email",C.current.value),t.append("description",F.current.value),t.append("ubigeo",R.current.value),t.append("latitude",n!==null?n.toString():""),t.append("longitude",l!==null?l.toString():""),t.append("manager",D.current.value),t.append("capacity",M.current.value),t.append("type",v.current.value),t.append("business_hours",JSON.stringify(k)),x.current&&x.current.files[0]&&t.append("image",x.current.files[0]),console.log("Datos a enviar:"),console.log("- Latitud:",n),console.log("- Longitud:",l);for(let a of t.entries())console.log(a[0]+": "+a[1]);await b.save(t)&&($(m.current).dxDataGrid("instance").refresh(),$(S.current).modal("hide"))},Q=async e=>{const{isConfirmed:r}=await c.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await b.delete(e)||$(m.current).dxDataGrid("instance").refresh()},I=(e,r,o)=>{const n=[...k];n[e][r]=o,L(n)},W=e=>{const r=e.latLng.lat(),o=e.latLng.lng();console.log("Coordenadas seleccionadas:",{lat:r,lng:o}),y({lat:r,lng:o}),g.current&&(g.current.value=r.toFixed(8)),h.current&&(h.current.value=o.toFixed(8)),c.fire({title:"Ubicación seleccionada",text:`Coordenadas: ${r.toFixed(6)}, ${o.toFixed(6)}`,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})},V=()=>{var o,n;const e=parseFloat((o=g.current)==null?void 0:o.value),r=parseFloat((n=h.current)==null?void 0:n.value);if(!isNaN(e)&&!isNaN(r)){const l={lat:e,lng:r};_(l),y(l)}},O=(e,r,o)=>{if(e==null||isNaN(e))return!1;const l=Math.abs(e).toString().split("."),t=l[0],d=l[1]||"";console.log(`Validando coordenada: ${e}`),console.log(`Parte entera: ${t} (${t.length} dígitos)`),console.log(`Parte decimal: ${d} (${d.length} dígitos)`),console.log(`Total permitido: ${r}, decimales permitidos: ${o}`),d.length>o&&console.log(`Advertencia: Truncando decimales de ${d.length} a ${o} dígitos`);const A=r-o;return t.length>A?(console.log(`Error: Excede dígitos enteros permitidos (${t.length} > ${A})`),!1):(console.log("Coordenada válida (se truncará automáticamente si es necesario)"),!0)},U=e=>$(N.renderToString(i.jsxs("span",{children:[i.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),i.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return i.jsxs(i.Fragment,{children:[i.jsx(le,{gridRef:m,title:"Tiendas / Sucursales",rest:b,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>G()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",cellTemplate:(e,{data:r})=>{r.image?e.html(N.renderToString(i.jsx("img",{src:`/storage/images/store/${r.image}`,alt:r.name,className:"img-thumbnail",style:{width:"50px",height:"50px",objectFit:"cover"}}))):e.html(N.renderToString(i.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:i.jsx("i",{className:"fas fa-store text-muted"})})))},allowExporting:!1},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:r})=>{const o={tienda_principal:"Tienda Principal",tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"},n={tienda_principal:"danger",tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"},l=o[r.type]||"No especificado",t=n[r.type]||"secondary";e.append(`<span class="badge bg-${t}">${l}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},{dataField:"phone",caption:"Teléfono",width:"120px"},{dataField:"email",caption:"Email",width:"180px"},{dataField:"manager",caption:"Encargado",width:"150px"},{dataField:"ubigeo",caption:"Ubicación",width:"150px",cellTemplate:(e,{data:r})=>{const o=j.find(n=>n.reniec==r.ubigeo);o?e.html(N.renderToString(i.jsxs("div",{children:[i.jsx("small",{className:"d-block",children:o.distrito}),i.jsxs("small",{className:"text-muted",children:[o.provincia,", ",o.departamento]})]}))):e.text(r.ubigeo||"Sin ubicación")}},{dataField:"status",caption:"Estado",width:"100px",cellTemplate:(e,{data:r})=>{e.html(N.renderToString(i.jsx("span",{className:`badge ${r.status?"bg-success":"bg-danger"}`,children:r.status?"Activa":"Inactiva"})))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>G(r)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Q(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),i.jsxs(se,{modalRef:S,title:Y?"Editar Tienda":"Agregar Tienda",onSubmit:K,size:"lg",children:[i.jsx("input",{ref:f,type:"hidden"}),i.jsxs("div",{id:"form-container",className:"row",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:w,label:"Nombre de la tienda",col:"col-12",required:!0})}),i.jsx("div",{className:"col-md-6",children:i.jsxs(H,{eRef:v,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[i.jsx("option",{value:"tienda_principal",children:"Tienda Principal"}),i.jsx("option",{value:"tienda",children:"Tienda"}),i.jsx("option",{value:"oficina",children:"Oficina"}),i.jsx("option",{value:"almacen",children:"Almacén"}),i.jsx("option",{value:"showroom",children:"Showroom"}),i.jsx("option",{value:"otro",children:"Otro"})]})}),i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:D,label:"Encargado",col:"col-12"})}),i.jsx("div",{className:"col-12",children:i.jsx(u,{eRef:E,label:"Dirección completa",col:"col-12",required:!0})}),i.jsx("div",{className:"col-12",children:i.jsx(H,{eRef:R,label:"Distrito/Ubigeo",col:"col-12",templateResult:U,templateSelection:U,dropdownParent:"#form-container",required:!0,children:j.map((e,r)=>i.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))})}),i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:T,label:"Teléfono",col:"col-12",type:"tel"})}),i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:C,label:"Email",col:"col-12",type:"email"})}),i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:i.jsxs("h5",{className:"card-title mb-0",children:[i.jsx("i",{className:"fas fa-map-marker-alt me-2"}),"Ubicación de la Tienda"]})}),i.jsxs("div",{className:"card-body",children:[i.jsx("div",{className:"mb-3",children:i.jsx(ee,{googleMapsApiKey:de.GMAPS_API_KEY,children:i.jsx(ie,{mapContainerStyle:{width:"100%",height:"400px",borderRadius:"8px"},center:z,zoom:15,onClick:W,options:{streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0},children:B&&i.jsx(re,{position:B,title:"Ubicación de la tienda"})})})}),i.jsxs("div",{className:"row",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:g,label:"Latitud",col:"col-12",type:"number",step:"0.00000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823",onChange:V})}),i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:h,label:"Longitud",col:"col-12",type:"number",step:"0.00000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506",onChange:V})})]}),i.jsx("div",{className:"row mt-3",children:i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"d-flex gap-2 flex-wrap",children:i.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{y(null),g.current.value="",h.current.value=""},children:[i.jsx("i",{className:"fas fa-eraser me-1"}),"Limpiar"]})})})})]})]})}),i.jsx("div",{className:"col-md-6",children:i.jsx(u,{eRef:M,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),i.jsx("div",{className:"col-12",children:i.jsx(ce,{eRef:x,label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),i.jsx("div",{className:"col-12",children:i.jsx(ae,{eRef:F,label:"Descripción",rows:3})}),i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Horarios de atención"}),i.jsx("div",{className:"table-responsive",children:i.jsxs("table",{className:"table table-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Día"}),i.jsx("th",{children:"Apertura"}),i.jsx("th",{children:"Cierre"}),i.jsx("th",{children:"Cerrado"})]})}),i.jsx("tbody",{children:k.map((e,r)=>i.jsxs("tr",{children:[i.jsx("td",{className:"align-middle",children:i.jsx("strong",{children:e.day})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:o=>I(r,"open",o.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:o=>I(r,"close",o.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsxs("div",{className:"form-check",children:[i.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:o=>I(r,"closed",o.target.checked)}),i.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},r))})]})})]})})]})]})]})};ne((j,m)=>{Z.createRoot(j).render(i.jsx(te,{...m,title:"Tiendas / Sucursales",children:i.jsx(pe,{...m})}))});
