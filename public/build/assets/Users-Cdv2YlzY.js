var A=Object.defineProperty;var q=(s,n,i)=>n in s?A(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i;var b=(s,n,i)=>q(s,typeof n!="symbol"?n+"":n,i);import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{r as t}from"./index-BOnQTV8N.js";import{c as k}from"./ReactAppend-DTVVXReZ.js";import{B as G}from"./Base-CewLMI0g.js";import{C as I}from"./CreateReactScript-Bw0vifCy.js";import{T as U}from"./Table-UhWMNAYe.js";import{I as a}from"./InputFormGroup-iZIO11ZN.js";import{R as u}from"./ReactAppend-D7S498fx.js";import{D as S}from"./DxButton-DV0H-ZcL.js";import{S as M}from"./SwitchFormGroup-B-vmnVqk.js";import{S as w}from"./ProductCard-Lp5WfZrB.js";import{B as P}from"./BasicRest-BCYKfs4R.js";import"./server.browser-Bf4gQIc7.js";import{M as _}from"./Modal-BYL-UsqM.js";import{S as E}from"./SelectFormGroup-D63EMIiA.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";/* empty css              */import"./Logout-W0zm0J8x.js";import"./main-DKOTUah5.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-u5lOOJwd.js";import"./index.esm-0RgdCKj2.js";import"./index-Dq7h7Pqt.js";import"./CanAccess-DKJVq_mE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-DRg3WPTA.js";class L extends P{constructor(){super(...arguments);b(this,"path","admin/users");b(this,"hasFiles",!1)}}const f=new L,z=({})=>{const s=t.useRef(),n=t.useRef(),i=t.useRef(),d=t.useRef(),h=t.useRef(),x=t.useRef(),l=t.useRef(),R=t.useRef(),v=t.useRef(),j=t.useRef(),g=t.useRef(),m=t.useRef(),[c,C]=t.useState(!1),N=e=>{e!=null&&e.id?C(!0):C(!1),i.current.value=(e==null?void 0:e.id)??"",d.current.value=(e==null?void 0:e.name)??"",h.current.value=(e==null?void 0:e.lastname)??"",x.current.value=(e==null?void 0:e.email)??"",l.current.value="",R.current.value="",v.current.value=(e==null?void 0:e.phone)??"",j.current.value=(e==null?void 0:e.phone_prefix)??"+51",g.current.value=(e==null?void 0:e.dni)??"",e!=null&&e.roles&&(e==null?void 0:e.roles.length)>0?$(m.current).val(e.roles[0].name).trigger("change"):$(m.current).val("Admin").trigger("change"),$(n.current).modal("show")},y=async e=>{if(e.preventDefault(),!c||l.current.value){if(l.current.value!==R.current.value){w.fire({title:"Error",text:"Las contraseñas no coinciden",icon:"error"});return}if(l.current.value.length<6){w.fire({title:"Error",text:"La contraseña debe tener al menos 6 caracteres",icon:"error"});return}}const o={id:i.current.value||void 0,name:d.current.value,lastname:h.current.value,email:x.current.value,phone:v.current.value,phone_prefix:j.current.value,dni:g.current.value,role:m.current.value};l.current.value&&(o.password=l.current.value),await f.save(o)&&($(s.current).dxDataGrid("instance").refresh(),$(n.current).modal("hide"))},D=async({id:e,value:o})=>{await f.boolean({id:e,field:"status",value:o})&&$(s.current).dxDataGrid("instance").refresh()},F=async e=>{const{isConfirmed:o}=await w.fire({title:"Eliminar usuario",text:"¿Estás seguro de eliminar este usuario?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!o||!await f.delete(e)||$(s.current).dxDataGrid("instance").refresh()},T=e=>{if(!e||e.length===0)return"Sin rol";const o=e[0].name;switch(o){case"Root":return"Super Administrador";case"Admin":return"Administrador";default:return o}},B=e=>{if(!e||e.length===0)return"badge-secondary";switch(e[0].name){case"Root":return"badge-danger";case"Admin":return"badge-primary";default:return"badge-secondary"}};return r.jsxs(r.Fragment,{children:[r.jsx(U,{gridRef:s,title:"Usuarios del Sistema",rest:f,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo usuario",hint:"Crear nuevo usuario",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre completo",width:"25%",cellTemplate:(e,{data:o})=>{u(e,r.jsxs("div",{children:[r.jsxs("strong",{children:[o.name," ",o.lastname]}),r.jsx("br",{}),r.jsx("small",{className:"text-muted",children:o.email})]}))}},{dataField:"phone",caption:"Teléfono",cellTemplate:(e,{data:o})=>{o.phone?u(e,r.jsxs("span",{children:[o.phone_prefix||"+51"," ",o.phone]})):u(e,r.jsx("span",{className:"text-muted",children:"- Sin teléfono -"}))}},{dataField:"dni",caption:"DNI",cellTemplate:(e,{data:o})=>{o.dni?u(e,r.jsx("span",{children:o.dni})):u(e,r.jsx("span",{className:"text-muted",children:"- Sin DNI -"}))}},{dataField:"roles",caption:"Rol",allowFiltering:!1,cellTemplate:(e,{data:o})=>{u(e,r.jsx("span",{className:`badge ${B(o.roles)}`,children:T(o.roles)}))}},{dataField:"status",caption:"Estado",dataType:"boolean",width:"120px",cellTemplate:(e,{data:o})=>{u(e,r.jsx(M,{checked:o.status==1,onChange:p=>D({id:o.id,value:p.target.checked})}))}},{caption:"Acciones",cellTemplate:(e,{data:o})=>{e.css("text-overflow","unset"),e.append(S({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>N(o)})),e.append(S({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>F(o.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(_,{modalRef:n,title:c?"Editar usuario":"Crear nuevo usuario",onSubmit:y,size:"lg",children:r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:i,type:"hidden"}),r.jsx(a,{eRef:d,label:"Nombres",col:"col-md-6",required:!0}),r.jsx(a,{eRef:h,label:"Apellidos",col:"col-md-6",required:!0}),r.jsx(a,{eRef:x,label:"Correo electrónico",type:"email",col:"col-md-6",required:!0}),r.jsx(a,{eRef:g,label:"DNI",col:"col-md-6"}),r.jsx("div",{className:"col-md-3",children:r.jsxs(E,{eRef:j,label:"Prefijo",required:!0,children:[r.jsx("option",{value:"+51",children:"+51 (Perú)"}),r.jsx("option",{value:"+1",children:"+1 (EE.UU.)"}),r.jsx("option",{value:"+34",children:"+34 (España)"}),r.jsx("option",{value:"+52",children:"+52 (México)"}),r.jsx("option",{value:"+57",children:"+57 (Colombia)"})]})}),r.jsx(a,{eRef:v,label:"Teléfono",type:"tel",col:"col-md-9"}),r.jsx("div",{className:"col-md-6",children:r.jsxs(E,{eRef:m,label:"Rol",required:!0,children:[r.jsx("option",{value:"Admin",children:"Administrador"}),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&r.jsx("option",{value:"Root",children:"Super Administrador"})]})}),r.jsxs("div",{className:"col-12",children:[r.jsx("hr",{}),r.jsx("h6",{children:c?"Cambiar contraseña (opcional)":"Contraseña"})]}),r.jsx(a,{eRef:l,label:c?"Nueva contraseña":"Contraseña",type:"password",col:"col-md-6",required:!c,placeholder:c?"Dejar vacío para mantener la actual":""}),r.jsx(a,{eRef:R,label:"Confirmar contraseña",type:"password",col:"col-md-6",required:!c})]})})]})};I((s,n)=>{k.createRoot(s).render(r.jsx(G,{...n,title:"Usuarios",children:r.jsx(z,{...n})}))});
