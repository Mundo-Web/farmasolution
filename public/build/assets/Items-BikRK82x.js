import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ae}from"./Base-CewLMI0g.js";import{S as A}from"./SwitchFormGroup-B-vmnVqk.js";import{T as Ee}from"./TextareaFormGroup-CliirJM1.js";import{r as s}from"./index-BOnQTV8N.js";import{c as Pe}from"./ReactAppend-DTVVXReZ.js";import{s as K}from"./server.browser-Bf4gQIc7.js";import{S as Ge}from"./ProductCard-Lp5WfZrB.js";import{I as xe}from"./ItemsRest-C_YH-lNL.js";import{M as ue}from"./Modal-BYL-UsqM.js";import{T as Be}from"./Table-UhWMNAYe.js";import{I as Y}from"./ImageFormGroup-Brimgjsn.js";import{I as w}from"./InputFormGroup-iZIO11ZN.js";import{Q as Me}from"./QuillFormGroup-ShbNmC_h.js";import{S as pe}from"./SelectAPIFormGroup-1XgklNMJ.js";import{S as O}from"./SelectFormGroup-D63EMIiA.js";import{D as de}from"./DxButton-DV0H-ZcL.js";import{C as Oe,F as p}from"./CreateReactScript-Bw0vifCy.js";import{N as fe}from"./Number2Currency-B5ZenVq9.js";import{R as I}from"./ReactAppend-D7S498fx.js";import{S as he}from"./SetSelectValue-UxyCmHse.js";import"./main-DKOTUah5.js";import{t as qe}from"./index-DRg3WPTA.js";import"./index-yBjzXJbu.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-W0zm0J8x.js";import"./MenuItemContainer-u5lOOJwd.js";import"./index.esm-0RgdCKj2.js";import"./index-Dq7h7Pqt.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CanAccess-DKJVq_mE.js";import"./BasicRest-BCYKfs4R.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const ge=({label:S,structure:g,value:R=[],onChange:N,typeOptions:b=[]})=>{const[j,d]=s.useState([]),f=typeof g=="object"&&!Array.isArray(g);s.useEffect(()=>{d(f?R.map(o=>{var a,m;return{...o,type:((a=o.type)==null?void 0:a.charAt(0).toUpperCase())+((m=o.type)==null?void 0:m.slice(1).toLowerCase())}}):R.map(o=>typeof o=="object"?o.feature||"":o))},[R]);const C=()=>{const o=f?{...g}:"",a=[...j,o];d(a),N(a)},x=o=>{const a=j.filter((m,c)=>c!==o);d(a),N(a)},v=(o,a,m)=>{const c=[...j];f?c[o][a]=a==="type"?m.charAt(0).toUpperCase()+m.slice(1).toLowerCase():m:c[o]=m,d(c),N(c)},F=(o,a)=>o==="title"&&a==="Icono"?"Url de icono":o;return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:S}),j.map((o,a)=>r.jsx("div",{className:"row g-2 mb-2",children:f?r.jsxs(r.Fragment,{children:[Object.keys(g).map(m=>r.jsx("div",{className:"col",children:m==="type"?r.jsxs("select",{className:"form-select",value:o[m]||"",onChange:c=>v(a,m,c.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),b.map(c=>r.jsx("option",{value:c,children:c},c))]}):r.jsx("input",{type:"text",className:"form-control",value:o[m]||"",onChange:c=>v(a,m,c.target.value),placeholder:F(m,o.type)})},m)),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>x(a),children:"X"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"col",children:r.jsx("input",{type:"text",className:"form-control",value:o,onChange:m=>v(a,null,m.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>x(a),children:"X"})})]})},a)),r.jsx("button",{type:"button",className:"btn btn-primary mt-2",onClick:C,children:"+ Agregar"})]})},Le=new xe,Ue=({gridRef:S,modalRef:g})=>{const[R,N]=s.useState(null),[b,j]=s.useState(!1),[d,f]=s.useState(""),[C,x]=s.useState(!1),v=o=>{N(o.target.files[0])},F=async()=>{var a,m;if(!R){f("Por favor, selecciona un archivo."),x(!0);return}const o=new FormData;o.append("file",R),j(!0);try{const c=await Le.importData(o);if(console.log(c),c.error){const D=Array.isArray(c.error)?c.error.join(`
`):c.error;f(`Error en la importación:
${D}`),x(!0)}else f(c.message),x(!1),$(S.current).dxDataGrid("instance").refresh(),$(g.current).modal("hide"),qe.success("Importacion completada con exito",{description:"Todos tus productos han sido importados correctamente.",duration:3e3,position:"bottom-center",richColors:!0})}catch(c){f("Error al importar: "+(((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.error)||c.message)),x(!0)}j(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{className:"mb-1",children:r.jsx("a",{href:"/assets/img/salafabulosa/formato_import_products.xlsx",download:!0,children:"Descargar formato .xlsx"})}),r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:v})}),r.jsx("button",{onClick:F,disabled:b,className:"btn btn-primary mt-2",type:"button",children:b?"Subiendo...":"Subir Archivo"}),d&&r.jsx("div",{className:`alert ${C?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:d})})]})})},E=new xe,Ve=({categories:S,brands:g,collections:R,stores:N})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[b,j]=s.useState([]),d=s.useRef(),f=s.useRef(),C=s.useRef(),x=s.useRef(),v=s.useRef(),F=s.useRef(),o=s.useRef(),a=s.useRef(),m=s.useRef(),c=s.useRef(),D=s.useRef(),q=s.useRef(),L=s.useRef(),U=s.useRef(),P=s.useRef(),G=s.useRef(),V=s.useRef(),z=s.useRef(),J=s.useRef(),Z=s.useRef(),Q=s.useRef(),W=s.useRef(),k=s.useRef(),be=s.useRef([]),je=s.useRef([]),[ve,ee]=s.useState(!1),[Re,ye]=s.useState(null),[ze,we]=s.useState(null),[Je,Se]=s.useState(null),[re,te]=s.useState(""),[B,y]=s.useState([]),se=s.useRef(),Ne=e=>{const l=Array.from(e.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));y(n=>[...n,...l])},Ce=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));y(n=>[...n,...l])},Fe=e=>{e.preventDefault()},Ie=(e,t)=>{e.preventDefault(),B[t].id?y(n=>n.map((i,h)=>h===t?{...i,toDelete:!0}:i)):y(n=>n.filter((i,h)=>h!==t))};s.useEffect(()=>{if(b&&b.images){const e=b.images.map(t=>({id:t.id,url:`/storage/images/item/${t.url}`}));y(e)}},[b]);const ne=e=>{var t,l,n;if(j(e||null),e!=null&&e.id?ee(!0):ee(!1),te(e!=null&&e.pdf?`/storage/images/item/${e.pdf}`:""),C.current.value=(e==null?void 0:e.id)||"",$(x.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(v.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),he(F.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(l=e==null?void 0:e.subcategory)==null?void 0:l.name),$(o.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),console.log("data item:",e),$(k.current).val(e!=null&&e.store_id&&e.store_id!==""?e.store_id:"").trigger("change"),a.current.value=(e==null?void 0:e.name)||"",J.current.value=(e==null?void 0:e.sku)||"",m.current.value=(e==null?void 0:e.color)||"",c.current.value=(e==null?void 0:e.size)||"",D.current.value=(e==null?void 0:e.summary)||"",W.current.value=(e==null?void 0:e.linkvideo)||"",q.current.value=(e==null?void 0:e.price)||0,L.current.value=(e==null?void 0:e.discount)||0,he(U.current,(e==null?void 0:e.tags)??[],"id","name"),P.current.value=null,G.current.value=null,P.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,G.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,V.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,te(e!=null&&e.pdf?`/storage/images/item/${e==null?void 0:e.pdf}`:""),z.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const i=e.images.map(h=>({id:h.id,url:`/storage/images/item/${h.url}`}));y(i)}else y([]);e!=null&&e.specifications?X(e.specifications.map(i=>({type:i.type,title:i.title,description:i.description,image:i.image||""}))):X([]),oe(((n=e==null?void 0:e.features)==null?void 0:n.map(i=>typeof i=="object"?i:{feature:i}))||[]),Q.current.value=e==null?void 0:e.stock,$(f.current).modal("show")},De=async e=>{e.preventDefault();const t=ie.filter(u=>{var T;return typeof u=="string"?u.trim()!=="":typeof u=="object"?((T=u.feature)==null?void 0:T.trim())!=="":!1}),l=le.filter(u=>u.title&&u.title.trim()!==""||u.description&&u.description.trim()!==""),n={id:C.current.value||void 0,category_id:x.current.value,collection_id:v.current.value||null,subcategory_id:F.current.value,brand_id:o.current.value,name:a.current.value,sku:J.current.value,color:m.current.value,size:c.current.value,summary:D.current.value,price:q.current.value,discount:L.current.value,tags:$(U.current).val(),description:z.current.value,stock:Q.current.value||0,features:t,specifications:l,linkvideo:W.current.value,store_id:k.current.value&&k.current.value!==""?k.current.value:null},i=new FormData;for(const u in n)u==="features"||u==="specifications"?i.append(u,JSON.stringify(n[u])):i.append(u,n[u]);const h=G.current.files[0];h&&i.append("image",h);const _=V.current.files[0];_&&i.append("texture",_);const ce=P.current.files[0];ce&&i.append("banner",ce);const ae=Z.current.files[0];ae&&i.append("pdf",ae),B.forEach((u,T)=>{u.toDelete||(u.file?i.append(`gallery[${T}]`,u.file):i.append(`gallery_ids[${T}]`,u.id))});const me=B.filter(u=>u.toDelete).map(u=>parseInt(u.id,10));me.length>0&&i.append("deleted_images",JSON.stringify(me)),console.log(i),await E.save(i)&&($(d.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"),y([]))},ke=async({id:e,value:t})=>{await E.boolean({id:e,field:"visible",value:t})&&$(d.current).dxDataGrid("instance").refresh()},M=async({id:e,field:t,value:l})=>{await E.boolean({id:e,field:t,value:l})&&$(d.current).dxDataGrid("instance").refresh()},_e=async e=>{const{isConfirmed:t}=await Ge.fire({title:"Eliminar item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await E.delete(e)||$(d.current).dxDataGrid("instance").refresh()},[ie,oe]=s.useState([]),[le,X]=s.useState([]),Te=["Principal","General","Icono"],[Qe,We]=s.useState(!1),H=s.useRef(),$e=()=>{$(H.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Be,{gridRef:d,title:"Items",rest:E,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>ne()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>$e()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},p.has("items","category_id")&&{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var l,n,i;e.html(K.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(l=t.collection)==null?void 0:l.name}),r.jsx("b",{className:"d-block",children:(n=t.category)==null?void 0:n.name}),r.jsx("small",{className:"text-muted",children:(i=t.subcategory)==null?void 0:i.name})]})))}},p.has("items","subcategory_id")&&{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},p.has("items","brand_id")&&{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{const n=((i,h)=>{if(!i)return"";const _=i.split(" ");return _.length>h?_.slice(0,h).join(" ")+"...":i})(t.summary,12);e.html(K.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{children:n})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(K.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",fe(t.price)]}),r.jsxs("span",{children:["S/.",fe(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{I(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},p.has("items","is_new")&&{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.is_new===1||t.is_new==="1"||t.is_new===!0;I(e,r.jsx(A,{checked:l,onChange:n=>M({id:t.id,field:"is_new",value:n.target.checked?1:0})}))}},p.has("items","offering")&&{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.offering===1||t.offering==="1"||t.offering===!0;I(e,r.jsx(A,{checked:l,onChange:n=>M({id:t.id,field:"offering",value:n.target.checked?1:0})}))}},p.has("items","recommended")&&{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.recommended===1||t.recommended==="1"||t.recommended===!0;I(e,r.jsx(A,{checked:l,onChange:n=>M({id:t.id,field:"recommended",value:n.target.checked?1:0})}))}},p.has("items","featured")&&{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.featured===1||t.featured==="1"||t.featured===!0;I(e,r.jsx(A,{checked:l,onChange:n=>M({id:t.id,field:"featured",value:n.target.checked?1:0})}))}},p.has("items","visible")&&{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{I(e,r.jsx(A,{checked:t.visible,onChange:l=>ke({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(de({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>ne(t)})),e.append(de({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>_e(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(ue,{modalRef:f,title:ve?"Editar item":"Agregar item",onSubmit:De,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:C,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(w,{eRef:J,label:"SKU",required:!0,hidden:!p.has("items","sku")}),r.jsx(O,{eRef:x,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ye(e.target.value),hidden:!p.has("items","category_id"),children:S.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(O,{eRef:v,label:"Colección",dropdownParent:"#principal-container",onChange:e=>we(e.target.value),hidden:!p.has("items","collection_id"),children:R.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(pe,{eRef:F,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",Re],dropdownParent:"#principal-container",hidden:!p.has("items","subcategory_id")}),r.jsx(O,{eRef:o,label:"Marca",dropdownParent:"#principal-container",hidden:!p.has("items","brand_id"),children:g.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsxs(O,{eRef:k,label:"Tienda",dropdownParent:"#principal-container",onChange:e=>Se(e.target.value),hidden:!p.has("items","store_id"),children:[r.jsx("option",{value:"",children:"Seleccionar tienda (opcional)"}),N.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))]}),r.jsx(w,{label:"Stock",eRef:Q,type:"number",required:!0,hidden:!p.has("items","stock")}),r.jsx(w,{eRef:q,label:"Precio",type:"number",step:"0.01",required:!0,hidden:!p.has("items","price")}),r.jsx(w,{eRef:L,label:"Descuento",type:"number",step:"0.01"}),r.jsx(pe,{id:"tags",eRef:U,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-5",children:[r.jsx(w,{eRef:a,label:"Nombre",required:!0,hidden:!p.has("items","name")}),r.jsx(w,{eRef:m,label:"Color",required:!0,hidden:!p.has("items","color")}),r.jsx(w,{eRef:c,label:"Talla",required:!0,hidden:!p.has("items","size")}),r.jsxs("div",{className:"col-12",hidden:!p.has("items","pdf"),children:[r.jsx("label",{className:"form-label",children:"Archivo PDF"}),r.jsx("input",{ref:Z,type:"file",className:"form-control",accept:".pdf"}),r.jsx("small",{className:"text-muted",children:"Subir documento PDF relacionado al producto"})]}),re&&r.jsx("div",{className:"my-2",children:r.jsxs("a",{href:re,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary",children:[r.jsx("i",{className:"fas fa-file-pdf me-1"})," Ver PDF actual"]})}),r.jsx(w,{eRef:W,label:"Link de video",hidden:!p.has("items","linkvideo")}),r.jsx(Y,{eRef:V,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6",hidden:!p.has("items","texture")}),r.jsx(Ee,{eRef:D,label:"Resumen",rows:3,hidden:!p.has("items","summary")}),r.jsx(ge,{ref:be,label:"Características",structure:"",value:ie,onChange:oe}),r.jsx(ge,{ref:je,label:"Especificaciones",structure:{type:"",title:"",description:""},value:le,onChange:X,typeOptions:Te})]}),r.jsx("div",{className:"col-md-4",children:r.jsxs("div",{className:"row",children:[r.jsx(Y,{eRef:P,label:"Banner",aspect:2/1,col:"col-12",hidden:!p.has("items","banner")}),r.jsx(Y,{eRef:G,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6",hidden:!p.has("items","image")}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:se,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Ne}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",itemr:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>se.current.click(),onDrop:Ce,onDragOver:Fe,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:B.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>Ie(l,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Me,{eRef:z,label:"Descripcion"})]}),r.jsx(ue,{modalRef:H,title:"Importar Datos",size:"sm",children:r.jsx(Ue,{gridRef:d,modalRef:H})})]})};Oe((S,g)=>{Pe.createRoot(S).render(r.jsx(Ae,{...g,title:"Items",children:r.jsx(Ve,{...g})}))});
